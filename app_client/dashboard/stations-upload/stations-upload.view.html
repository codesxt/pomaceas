<div class="app-container container-fluid">
<div class="row">
  <dashboard-navigation></dashboard-navigation>
  <div class="col-md-9">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Subir datos a una estación</h3>
      </div>
      <div class="panel-body">
        <div class="alert alert-danger" role="alert" ng-show="vm.errMessage">{{ vm.errMessage }}</div>
        <form class="form-inline well clearfix">

          <div class="form-group col-md-4">
            <label for="station" class="control-label">Estación</label><br/>
            <select class="form-control" id="station" ng-model="vm.stationId">
              <option ng-repeat="stat in vm.stations" value="{{ stat._id }}">
                {{ stat.name }}, {{ stat.city}}, {{ stat.region }} Región
              </option>
            </select>
          </div>

          <div class="col-md-8">
            <span ng-if="!vm.stationSummary.lastReading">
              La estación seleccionada no tiene datos.
            </span>
            <span ng-if="vm.stationSummary.lastReading">
              <p>
                <strong>Último Registro:</strong>
                {{ vm.stationSummary.lastReading | amUtc | amDateFormat:'DD [de] MMMM [de] YYYY HH:mm:ss' }}
              </p>
              <p>
                <strong>Primer Registro:</strong>
                {{ vm.minDate | amDateFormat:'DD [de] MMMM [de] YYYY HH:mm:ss' }}
              </p>
            </span>
          </div>
        </form>
        <hr/>

        <div class="panel panel-default" ng-if="vm.stationId">
          <div class="panel-heading">
            Subir datos a la estación
          </div>
          <div class="panel-body">
            <div class="alert alert-danger" role="alert" ng-show="vm.uploadError">{{ vm.uploadError }}</div>
            <div class="alert alert-info" role="alert" ng-show="vm.uploadInfo">{{vm.uploadInfo}}</div>
            <div class="alert">
              <p>Para subir datos a la estación se debe considerar:</p>
              <ol>
                <li>
                  Verifique que el archivo a subir sea un archivo de texto o .csv
                </li>
                <li>
                  Las dos primeras líneas del archivo se considerarán como etiquetas de las variables y las demás líneas como datos
                </li>
                <li>
                  Las columnas del archivo deben estar separadas por tabulaciones
                </li>
              </ol>
              <p>Pasos para subir datos a la estación:</p>
              <ol>
                <li>
                  Seleccionar el archivo a importar presionando en 'Examinar'
                </li>
                <li>
                  Cargar el archivo a la memoria presionando en 'Cargar'
                </li>
                <li>
                  Al Cargar, se mostrarán las 100 primeras líneas del archivo para verificar que se cargó correctamente
                </li>
                <li>
                  Si el archivo se cargó correctamente, presionar 'Subir' para enviar los datos al servidor
                </li>
              </ol>
              <p>* La subida puede demorar unos minutos dependiendo del tamaño de los datos</p>
            </div>
            <input id="file" class="btn btn-default" type="file">
            <button class="btn btn-success" ng-click="vm.loadFile()">Cargar archivo</button>
            <button class="btn btn-danger" ng-if="vm.isDataLoaded" ng-click="vm.uploadData()">Subir Archivo</button>
            <br/>
            <br/>
            <div class="progress">
              <div class="progress-bar progress-bar-success" style="width: {{vm.loadProgress}}%"></div>
            </div>
            <div class="progress" ng-class="{active: vm.isUploading, 'progress-striped': vm.isUploading}">
              <div class="progress-bar" style="width: {{vm.uploadProgress}}%"></div>
            </div>
            <table class="table table-striped table-hover" ng-show="vm.isDataLoaded">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Temp Out</th>
                  <th>Hi Temp</th>
                  <th>Low Temp</th>
                  <th>Out Hum</th>
                  <th>Wind Speed</th>
                  <th>Rain</th>
                  <th>Solar Rad.</th>
                  <th>ET</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="line in vm.fileDataDisplay">
                  <td ng-repeat="data in line track by $index">
                    {{data}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
</div>
